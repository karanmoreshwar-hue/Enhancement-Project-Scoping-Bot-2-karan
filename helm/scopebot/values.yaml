# Scopebot Umbrella Chart Values
# This file contains configuration for all subcharts
# Values are pre-filled from your .env file

# Global configuration
global:
  namespace: scopebot

# Frontend subchart configuration
frontend:
  replicaCount: 1
  image:
    repository: scopingbotacr.azurecr.io/scopebot-frontend
    tag: latest
    pullPolicy: IfNotPresent
  imagePullSecrets:
    - name: acr-secret
  service:
    type: NodePort  # Changed to NodePort for external access via VM public IP
    port: 80
    nodePort: 30080  # Fixed port for frontend access

# Backend subchart configuration
backend:
  replicaCount: 1
  image:
    repository: scopebot-backend
    tag: latest
    pullPolicy: IfNotPresent
  imagePullSecrets:
    - name: acr-secret
  service:
    type: NodePort  # Changed to NodePort for external access via VM public IP
    port: 8000
    nodePort: 30800  # Fixed port for backend access

  # Non-sensitive environment variables
  env:
    ANONYMIZED_TELEMETRY: "False"
    USE_GEMINI: "false"
    FRONTEND_URL: "http://scopebot-frontend"
    VECTOR_DIM: "4096"
    QDRANT_HOST: "scopebot-qdrant"
    QDRANT_PORT: "6333"
    QDRANT_COLLECTION: "knowledge_chunks"

  # Sensitive environment variables
  # DO NOT hardcode secrets here! Use GitHub Secrets in CI/CD or external secret management
  # These values will be injected from environment variables or external sources
  secrets:
    # Gemini API (optional - leave empty if using Azure)
    GEMINI_API_KEY: ""
    GEMINI_MODEL: "gemini-2.0-flash"

    # Jina Embeddings (optional if using Azure embeddings)
    JINA_API_KEY: ""
    JINA_MODEL: "jina-embeddings-v2-base-en"

    # Database Configuration - REQUIRED (will be injected from GitHub Secrets)
    POSTGRES_DB: "scopebot_db"
    POSTGRES_USER: "scopebot"
    POSTGRES_PASSWORD: ""  # Will be injected from GitHub Secrets
    DATABASE_URL: ""  # Will be constructed from GitHub Secrets

    # Authentication - REQUIRED (will be injected from GitHub Secrets)
    SECRET_KEY: ""  # Will be injected from GitHub Secrets
    ALGORITHM: "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: "1440"  # 1 day
    REFRESH_TOKEN_EXPIRE_DAYS: "7"

    # Email Configuration (SMTP for OTP Reset) - will be injected from GitHub Secrets
    SMTP_HOST: ""  # Will be injected from GitHub Secrets
    SMTP_PORT: ""  # Will be injected from GitHub Secrets
    SMTP_USER: ""  # Will be injected from GitHub Secrets
    SMTP_PASS: ""  # Will be injected from GitHub Secrets

    # Ollama Configuration - will be injected from GitHub Secrets
    OLLAMA_HOST: ""  # Will be injected from GitHub Secrets
    OLLAMA_MODEL: "deepseek-r1:latest"
    OLLAMA_EMBED_MODEL: "qwen3-embedding:latest"

    # Azure Storage - will be injected from GitHub Secrets
    AZURE_STORAGE_ACCOUNT: ""  # Will be injected from GitHub Secrets
    AZURE_STORAGE_KEY: ""  # Will be injected from GitHub Secrets
    AZURE_STORAGE_CONTAINER: ""  # Will be injected from GitHub Secrets

  volumes:
    localStoragePath: "./local_storage"
    knowledgeBasePath: "./knowledgebase_base/docs"
    chromaPersistDir: "./chroma_db"

# PostgreSQL subchart configuration
postgres:
  replicaCount: 1
  image:
    repository: postgres
    tag: "15-alpine"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 5432
  postgres:
    database: "scopebot_db"  # Must match POSTGRES_DB above
    user: "scopebot"
    password: ""  # Will be injected from GitHub Secrets
  persistence:
    enabled: true  # Enable persistent volumes for data safety
    size: 10Gi
    storageClass: ""  # Use default storage class

# Qdrant subchart configuration
qdrant:
  replicaCount: 1
  image:
    repository: qdrant/qdrant
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 6333
    grpcPort: 6334
  persistence:
    enabled: true  # Enable persistent volumes for data safety
    size: 10Gi
    storageClass: ""  # Use default storage class